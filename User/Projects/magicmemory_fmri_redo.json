{
  "all_procs": {
    "procedure_1.csv": "item,code,max time,text,shuffle 1,comment,survey,\r\n0,instruct,user,\"<p> Dear participant </p><p> Thank you very much for accepting the invitation to participate in the second part of the MAGMOT study. </p><p> During this part, you will be asked to try to remember the magic tricks you have seen inside the MRI scanner a week ago. <br> This includes a cued recall where we will present you still images of each of the 36 magic tricks and ask you to briefly describe what has happened in the magic trick. Depending on your answers in the recall tests, we will categories each magic trick you have seen in the first experiment as either remembered or forgotten. To enable us to do that, please try to be as distinct, specific and descriptive as possible when referring to the magic tricks. <br> Further, there will be a recognition test where you will see the same 36 still images and offered four choices to answer the question, \"\"what happens in this magic trick?\"\". You are asked to pick the correct answer and to indicate afterwards how confident you feel regarding your answer.</p><p> We estimate the duration of the task to be 45 min. You will receive additional course credit/monetary reward for your participation in this part of the study. </p>\",off,Welcome,,\r\n0,instruct,user,\"<p> In the following trials, we will present you still images of the 36 magic tricks you have seen in random order. Please write down what has happened in the trick cued by the picture.  </p><p> Again, please try to write down your answer as descriptive as possible, so that we are able to judge whether you recalled a specific magic trick or not.</p> If you cannot recall what has happened in the magic trick cued by the still image, please insert \"\"no recall\"\".\",off,instruction,,\r\n2,magic_recall,user,,off,experiment,,\r\n3,magic_recall,user,,off,experiment,,\r\n4,magic_recall,user,,1,experiment,,\r\n5,magic_recall,user,,1,experiment,,\r\n6,magic_recall,user,,1,experiment,,\r\n7,magic_recall,user,,1,experiment,,\r\n8,magic_recall,user,,1,experiment,,\r\n9,magic_recall,user,,1,experiment,,\r\n10,magic_recall,user,,1,experiment,,\r\n11,magic_recall,user,,1,experiment,,\r\n12,magic_recall,user,,1,experiment,,\r\n13,magic_recall,user,,1,experiment,,\r\n14,magic_recall,user,,1,experiment,,\r\n15,magic_recall,user,,1,experiment,,\r\n16,magic_recall,user,,1,experiment,,\r\n17,magic_recall,user,,1,experiment,,\r\n18,magic_recall,user,,1,experiment,,\r\n19,magic_recall,user,,1,experiment,,\r\n20,magic_recall,user,,1,experiment,,\r\n21,magic_recall,user,,1,experiment,,\r\n22,magic_recall,user,,1,experiment,,\r\n23,magic_recall,user,,1,experiment,,\r\n24,magic_recall,user,,1,experiment,,\r\n25,magic_recall,user,,1,experiment,,\r\n26,magic_recall,user,,1,experiment,,\r\n27,magic_recall,user,,1,experiment,,\r\n28,magic_recall,user,,1,experiment,,\r\n29,magic_recall,user,,1,experiment,,\r\n30,magic_recall,user,,1,experiment,,\r\n31,magic_recall,user,,1,experiment,,\r\n32,magic_recall,user,,1,experiment,,\r\n33,magic_recall,user,,1,experiment,,\r\n34,magic_recall,user,,1,experiment,,\r\n35,magic_recall,user,,1,experiment,,\r\n36,magic_recall,user,,1,experiment,,\r\n37,magic_recall,user,,1,experiment,,\r\n0,instruct,user,\"<p> Thank you for completing the cued recall task. </p> Next, there will be a recognition memory test. You will see the same images as before in random order and again, you are asked to correctly recall what has happened in the magic trick. This time, however, you will be offered with four answers and we would kindly ask you to pick the correct one. Afterwards, please indicate how confident you are regarding your answer. That means if you are certain that this is the correct answer, your confidence will be high whereas it is low in case you are guessing.\",off,,,\r\n2,magic_recognition,user,,2,experiment,,\r\n3,magic_recognition,user,,2,experiment,,\r\n4,magic_recognition,user,,2,experiment,,\r\n5,magic_recognition,user,,2,experiment,,\r\n6,magic_recognition,user,,2,experiment,,\r\n7,magic_recognition,user,,2,experiment,,\r\n8,magic_recognition,user,,2,experiment,,\r\n9,magic_recognition,user,,2,experiment,,\r\n10,magic_recognition,user,,2,experiment,,\r\n11,magic_recognition,user,,2,experiment,,\r\n12,magic_recognition,user,,2,experiment,,\r\n13,magic_recognition,user,,2,experiment,,\r\n14,magic_recognition,user,,2,experiment,,\r\n15,magic_recognition,user,,2,experiment,,\r\n16,magic_recognition,user,,2,experiment,,\r\n17,magic_recognition,user,,2,experiment,,\r\n18,magic_recognition,user,,2,experiment,,\r\n19,magic_recognition,user,,2,experiment,,\r\n20,magic_recognition,user,,2,experiment,,\r\n21,magic_recognition,user,,2,experiment,,\r\n22,magic_recognition,user,,2,experiment,,\r\n23,magic_recognition,user,,2,experiment,,\r\n24,magic_recognition,user,,2,experiment,,\r\n25,magic_recognition,user,,2,experiment,,\r\n26,magic_recognition,user,,2,experiment,,\r\n27,magic_recognition,user,,2,experiment,,\r\n28,magic_recognition,user,,2,experiment,,\r\n29,magic_recognition,user,,2,experiment,,\r\n30,magic_recognition,user,,2,experiment,,\r\n31,magic_recognition,user,,2,experiment,,\r\n32,magic_recognition,user,,2,experiment,,\r\n33,magic_recognition,user,,2,experiment,,\r\n34,magic_recognition,user,,2,experiment,,\r\n35,magic_recognition,user,,2,experiment,,\r\n36,magic_recognition,user,,2,experiment,,\r\n37,magic_recognition,user,,2,experiment,,\r\n0,instruct,user,\"<p> Thank you for completing the recognition task. </p><p> You are nearly at the end of the experiment. </p><p> On the next page, there will be a short questionnaire. Afterwards, you will be debriefed and directed to the completion code.</p>\",off,,,\r\n0,survey,user,,off,questionnaire,postquestions_magicmemory_fmri,\r\n0,debrief_magmot,user,\"<p> Dear participant, </p><p> Thank you for completing the task. </p><p> The purpose of this study was to find out how curiosity and the availability of reward can influence memory performances. We hypothesise that both, reward and high levels of curiosity will have enhancing effects and lead to the magic tricks being better encoded. We further investigate the neural underpinnings of this phenomena which we expect to be mirrored in the reward network, medial temporal lobe and mid brain.</p><p> We manipulated the availability of reward in the following ways: Some participants were not offered any reward for finding the correct estimate on how many people are able to find the solution, while other participants were offered an additional Â£0.80 for each correct estimate on how many people are able to find the solution to the magic trick.</p><p> We offered money to some of the participants to be able to look at the effect of the availability of monetary reward on memory. We asked you to rate your curiosity to determine how curiosity influences memory performances. We asked you to provide an estimate on how many people will be able to solve the magic trick to make sure that you are engaged in the task and pay attention to it. However, we never collected data on how many people are able to find the solution Ã¢ÂÂ therefore, there are no right or wrong answers to this question, and this was our cover story. We would like to apologise for any inconveniences caused by this. Out of curtesy, we pay the same bonus to all participants. </p><p> We would like to thank you again for participating in this experiment and supporting our research. If you have any additional questions, please do not hesitate to contact us. </p><p> Kind regards, </p><p> Stef Meliss (email: stefanie.meliss@pgr.reading.ac.uk) and Kou Murayama (email: k.murayama@reading.ac.uk) </p>\",off,debrief,,"
  },
  "all_stims": {
    "stimuli_1.csv": "stimID,Image,option1,option2,option3,option4,\r\nH7,../User/Stimuli/H7_cue.png,The magician lets a coin appear everywhere around the salt shaker.,The magician changes the salt to water.,The magician wraps the salt shaker in the cloth and makes it disappear.,The salt shaker turns into a bottle.,\r\nH10,../User/Stimuli/H10_cue.png,The magician magically repairs split card.,The magician is able to split and put back together a card.,\"Without touching it, the magician is able to move the pieces of the cards further and further away from each other.\",The magician places his hand over the card multiple times and each time a piece disappears.,\r\nH15,../User/Stimuli/H15_cue.png,The magician balances a toothpick on a deck of cards.,\"The magician pierces the deck of cards with a toothpick, but afterwards there is no hole.\",The magician lets a card picked by the volunteer appear in the card box.,\"When the magician starts to shake the card box, toothpicks start to fall out of the box and the cards have vanished.\",\r\nH16,../User/Stimuli/H16_cue.png,The magician pours coke into a glass from an empty can.,The magician is able to remove the dents from the can without touching it.,The magician pours coke into a glass and makes it disappear.,\"Although the can seems empty, the magician is able to pour sparkling water.\",\r\nH17,../User/Stimuli/H17_cue.png,\"The magician uses a guillotine to slice breadsticks, but not the volunteer's finger.\",The magician rejoins bread sticks which the volunteer sliced with the guillotine.,\"The magician places the bread sticks in the bag, when the volunteer looks into the bag the bread sticks have transformed into a bun.\",\"The volunteer tries to slice breadsticks with the guillotine, but cannot do it.\",\r\nH19,../User/Stimuli/H19_cue.png,\"The magician places paper in volunteer's hand and sets it alight, revealing a red sponge ball.\",The magician lights matches without touching them.,The magician transforms matches into a lighter.,The magician presses a lit match into volunteer's hand without hurting her.,\r\nH35,../User/Stimuli/H35_cue.png,The volunteer signs a card which the magician subsequently pulls from a Ziploc bag.,\"While the magician is shuffling the deck of cards, all four aces start to appear in the Ziploc bag.\",The magician puts all the cards into the Ziploc bag. After snapping their fingers the cards appear in the box and the bag is empty again.,\"The volunteer signs a card that is placed into the Ziploc bag, but then appears in the card box.\",\r\nH36,../User/Stimuli/H36_cue.png,The nut is placed on the middle of the bold by the volunteer and magically unscrews itself.,\"The magician shrinks the bolt, so that the nut does not stay on it any longer.\",The magician places the nut in the middle of the bold and it magically screws itself.,The magician bends the bolt by hand.,\r\nH37,../User/Stimuli/H37_cue.png,The magician unscrews his own finger and then shakes it back into place.,\"The magician claps his gloved hands, the gloves dissapear leaving his hands bare.\",The magician turns his gloves into mittens.,\"The magician detaches his thumb, but when he turns his hands, the thumb is reattached.\",\r\nK2,../User/Stimuli/K2_cue.png,Green and golden sweets fall out of the pages of the book.,The sweets shown on the pages disappear.,Gummi bears fall out of the book.,Micky and Mini Mouse from the pages of the book are poured out onto the table as little biscuits.,\r\nK3,../User/Stimuli/K3_cue.png,The magician makes ladybirds appear and then disappear again.,The magician changes the shape of the leaf.,The magician takes the leaf and turns it into a box of flowers.,The magician changes the colour of the leaf several times.,\r\nK4,../User/Stimuli/K4_cue.png,The magician solves the rubix cube by spinning it in the air.,The rubix cube levitates.,The rubix cube turns into a ball.,The magician shakes the rubix cube and it becomes all white.,\r\nK10,../User/Stimuli/K10_cue.png,The safety pins magically interlock without breaking the seal.,The safety pins magically double in size.,\"Although there are two safety pins at the beginning, they are magically melt together.\",The magician uses the safety pins to create a little star.,\r\nK16_short,../User/Stimuli/K16_short_cue.png,\"The volunteer selects and signs a card that is placed in the middle of the deck, but then appears on the top of it.\",\"The magician shuffles the cards and places them in front of him. When he taps the card with the pen, they spread out.\",\"The magician covers the unsorted cards with a silk handkerchief. When the handkerchief is removed, each of the cards is marked.\",\"The magician asks the volunteer to mark the cards using the pen. After he shuffles them, the volunteer's writing has disappeared from all of the cards.\",\r\nK18,../User/Stimuli/K18_cue.png,A pack of cards appears from a single piece of paper.,The magician folds the sheet of paper smaller and smaller until it transforms into a pack of cards.,The magician splays out the cards more and more until they resemble bunting.,The magician turns the sheet of paper which now shows a bouquet of flowers.,\r\nK19_long,../User/Stimuli/K19_long_cue.png,The balls magically change their location and become a toy rabbit.,The print on the mug changes from a black Q10 to a red B2.,The red balls are placed under the mug and merge to become a form a larger ball.,\"The magician covers the mug and the red balls with a handkerchief. When he removes it, there is a tea pot with a red lid.\",\r\nK21_long,../User/Stimuli/K21_long_cue.png,The magician flips the middle card over with a slight gesture and then changes the colour of the back of the card from blue to red.,The magician reduces a full deck of cards to only three cards.,The magician places a card between two other cards and makes it disappear.,The magician transforms three cards into a full deck.,\r\nK24,../User/Stimuli/K24_cue.png,A Â£10 note is transformed into a Â£20  note.,The note is folded so small that it disappears.,The magician makes a note out of a flower.,The magician folds the Â£10 note in a piece of paper and tears it. He reveals that the note is still intact afterwards.,\r\nS9,../User/Stimuli/S9_cue.png,The cards magically change their appearance.,\"The magician covers the cards with a silk handkerchief. After the silk is removed, the cards are blank.\",The magician shows a card and then pulls the correct card from a shuffled deck.,The cards spread across the table into a circle without being touched.,\r\nS11,../User/Stimuli/S11_cue.png,The magician pushes a cigarette through a coin and then reveals that there is no hole.,\"The coin and the cigarette melt into another, so that the cigarette becomes metal.\",\"The magician pushes a cigarette through a coin, but after he has pushed it through, he reveals that the cigarette is a ÃÂ£10 note.\",\"The magician uses the coin to slice the cigarette, but it is still intact afterwards.\",\r\nS12,../User/Stimuli/S12_cue.png,The magician punches a hole in the card. He then moves the hole from one corner to another before finally revealing that it is actually a black spot on the card.,The magician punches a hole into the card. This hole expands as the magician opens his fist.,\"The magician punches circular holes into the card, but after the card is turned, the punched holes have a square shape.\",\"The magician punches a hole into the card, which then becomes a toy ladybird.\",\r\nS15,../User/Stimuli/S15_cue.png,The magician places a ring on the stem of the glass without breaking it.,\"The magician places the glass upside down on the ring and covers it with a piece of silk. When he removes it, the ring is placed on the stem.\",The magician puts the ring into the glass and starts tossing it around until the ring is around the stem.,The magician removes the glass and puts a ring on the stem before reattaching it.,\r\nS18,../User/Stimuli/S18_cue.png,The magician pulls three boxes containing flowers from a paper bag.,The magician is able to hide his whole arm inside the blue paper bag.,The magician produces a rabbit out of the empty paper bag.,When the magician turns the bag inside-out the bag folds into a paper aeroplane.,\r\nS21,../User/Stimuli/S21_cue.png,The magician detaches the head of a spoon by moving the handle up and down.,The magician detaches the head of a spoon by turning the handle clockwise and counter clockwise.,The magician bents the spoon only sing his pinkie as a force.,\"The magician covers the spoon with a handkerchief. When he removes it, the spoon is bent.\",\r\nS25,../User/Stimuli/S25_cue.png,The magician makes a silk handkerchief appear inside a bread roll.,The magician makes bread rolls appear in his hands.,\"The magician holds a bread roll in his left hand, which then appears in his right hand.\",The magician makes a signed coin appear inside a bread roll.,\r\nS27,../User/Stimuli/S27_cue.png,\"The magician pours water into a cup from the bottle and then pours the water into another cup but when he tips it upside down, no water spills out.\",\"The magician pours water into a cup from the bottle, but when he tips it upside down, no water spills out.\",\"Although the magician pours water into both cups, the water bottle seems to refill itself magically whenever the magician snaps his fingers.\",\"The magician pours water into one cup, but the other cup is magically refilled.\",\r\nS30,../User/Stimuli/S30_cue.png,The magician pulls string through two sticks which appear to be connected. However he then reveals thw two sticks are not connected at all.,The magician is able to join the two separated parts of the stick.,\"Without any movement, the magician lets the strings in the sticks dance in little circles around him.\",The magician cuts a piece of string in several places and then magically puts it back together again.,\r\nS31,../User/Stimuli/S31_cue.png,\"The magician places chopsticks into an envelope, but is still able to crush the envelope and its contents into a paper ball.\",The magician transforms the envelope into a ÃÂ£10 note.,\"As the magician turns around the envelope, writing appears on it.\",The magician folds the envelope multiple times until he reveals that it is a pair of chop sticks.,\r\nTrick4,../User/Stimuli/Trick4_cue.png,The magician puts the mobile phone inside the balloon with a simple gesture of his hands.,\"As the magician blows up the balloon, the phone increases in size.\",\"The magician blows up an orange balloon, then the phone flashes and the balloon turns yellow.\",\"As the balloon deflates, the phones starts moving across the surface without the magician touching it.\",\r\nTrick6_short,../User/Stimuli/Trick6_short_cue.png,\"The magician puts a ball under the cup, which then turns into a larger ball and then becomes an egg.\",The magician puts the ball under the cup which then turns into an egg and then becomes a chicklet.,The magician puts the ball under the cup and makes it disappear.,\"The magician places a red ball underneath the cup, but when he lifts it up, it is an orange balloon.\",\r\nTrick7_short,../User/Stimuli/Trick7_short_cue.png,\"The magician gets the volunteer to hold a foam ball, which he then transforms into  two balls.\",The magician places two foam balls in volunteer's hands. The foam balls then start to jump up and down of their own accord.,\"The magician places two foam balls in volunteer's hand and sets them alight, revealing two paper balls.\",Two sponge balls turn into a cube.,\r\nTrick20_short,../User/Stimuli/Trick20_short_cue.png,\"The magician shows the volunteer metal nut and rope. Although he secures the nut with the rope, it repeatdely escapes.\",\"The magician ties a knot around the volunteer's wrist using the rope. After snapping his finger, the nut is tied in the rope, too.\",\"The volunteer holds the nut in her hands which are then tied with the rope. When the magician removes the rope, the nut is no longer in the volunteer's hand but appears in the magician's pocket.\",\"The magician ties rope around the nut, but is not able to remove it afterwards as it seems that the nut has shrunk.\",\r\nTrick28,../User/Stimuli/Trick28_cue.png,The magician links and unlinks several silver rings while they keep their shape.,\"Starting with small rings, the magician merges them so that there are less rings in total, but they are larger in size.\",\"The magician firstly puts the rings around his arms, but after he turns around, the volunteer has them around their arms.\",The magician links and unlinks several silver rings while the rings shape their appearance once they get linked.,\r\nTrick32_long,../User/Stimuli/Trick32_long_cue.png,The magician makes a silver coin disappear and reappear several times before it is transformed into a large coin.,The magician has a coin in each of his hands. They both end up in one hand.,\"The magician shows a silver and a copper coin. Every time he puts a coin in his pocket, the coin appears again in his hand.\",The magician ask the volunteer for a coin. Then the coin magically bends inside the closed fist of the volunteer.,\r\nTrick37,../User/Stimuli/Trick37_cue.png,An elastic band visually travels from finger to finger.,\"The magician has an elastic band on his hand, which then magically ends up around the volunteer's hand.\",The magician makes several star shapes using the two elastic bands and then produces a star shaped elastic band.,The magician has two elastic bands and tangles them up. They then become untwisted.,\r\nTrick38,../User/Stimuli/Trick38_cue.png,\"The magician closes one fist around a silk handkerchief and makes it disappear. Then, he makes it appear in his other hand.\",The magician makes a little bird figure appear under the silk handkerchief.,The magician takes a coin from the volunteer and freezes it in the silk.,\"The magician closes his hand around a green silk handerchief, but when he opens his hand, the silk is blue.\",\r\nH4_long,../User/Stimuli/H4_long_cue.png,The magician makes the coins disappear from his hands and reappear under one of the cards.,\"The magician changes the colour of the cards from red to black. \",The magician lets all the coins disappear.,The magician doubles the number of cards.,\r\nK23,../User/Stimuli/K23_cue.png,\"The magician pierces the note with the pen, but the note is intact afterwards.\",\"The magician draws glasses on the queen's face, but when he snaps his fingers, it disappears.\",The magician turns the note from purple to dark green.,The magician makes the money disappear and then reappear in the volunteer's hand.,\r\n,,,,,,"
  },
  "public_key": "2tSByMGgcvO5XjygqtEYX1jbw0ju1R2TFlPPJ9W6FkE=",
  "surveys": {
    "postquestions_magicmemory_fmri": [
      [
        "item_name",
        "text",
        "Type",
        "Answers",
        "Values",
        "Optional",
        ""
      ],
      [
        "Instructions1",
        "Choose one response that best describes how strongly each item applies to you:",
        "Instruct",
        "",
        "",
        "",
        ""
      ],
      [
        "sleep",
        "I slept between my participation in the first and second part of the study.",
        "likert",
        "Yes|No",
        "1|0",
        "No",
        ""
      ],
      [
        "sleep_hours",
        "If yes, how many hours did you approximately sleep in total between your first and second participation?",
        "Number",
        "",
        "",
        "No",
        ""
      ],
      [
        "test_known",
        "When watching the magic tricks, I was aware that my memory of them will be tested later.",
        "likert",
        "Definitely agree |Somehow agree|Slightly agree|Slightly disagree|Somehow disagree|Definitely disagree",
        "6|5|4|3|2|1",
        "No",
        ""
      ],
      [
        "memory_intention",
        "When watching the magic tricks, I tried to encode them.",
        "likert",
        "Definitely agree |Somehow agree|Slightly agree|Slightly disagree|Somehow disagree|Definitely disagree",
        "6|5|4|3|2|1",
        "No",
        ""
      ],
      [
        "reward_belief",
        "Please answer the following statement ONLY IF you have been offered <b>additional ÃÂ£0.80 bonus per correct answer</b>. If you have not been offered additional bonus, please select \"not applicable.\"<p>Did you believe that you would receive a bonus payment based on your performance?</p>",
        "likert",
        "Definitely agree |Somehow agree|Slightly agree|Slightly disagree|Somehow disagree|Definitely disagree|Not applicable",
        "6|5|4|3|2|1|999",
        "No",
        ""
      ],
      [
        "magictrick_experience",
        "I have experiences in producing magic tricks.",
        "likert",
        "Very frequently | Frequently | Occasionally | Rarely | Very rarely | Never",
        "6|5|4|3|2|1",
        "No",
        ""
      ],
      [
        "connection",
        "There were no problems with the internet connection while I participated in the experiment.",
        "likert",
        "Definitely agree |Somehow agree|Slightly agree|Slightly disagree|Somehow disagree|Definitely disagree",
        "6|5|4|3|2|1",
        "No",
        ""
      ],
      [
        "comment",
        "Is there anything else you would like us to know?",
        "Text",
        "",
        "",
        "Yes",
        ""
      ],
      [
        "",
        "",
        "",
        "",
        "",
        "",
        ""
      ]
    ]
  },
  "trialtypes": {},
  "location": "https://www.dropbox.com/s/w8ebga5r7qoura6/magicmemory_fmri_redo.json?dl=0",
  "conditions": "name,notes,stimuli,procedure,fullscreen,welcome,participant_id,end_message,start_message,buffer,scripts,\r\ncondition_1,You can put more detailed notes in this field,stimuli_1.csv,procedure_1.csv,on,,on,\"Thank you again for completing this last part of the study. The completion code is \"\"Obliviate\"\". Please email it to s.meliss@reading.ac.uk\",Please insert the study ID here that has been sent to you in the email.,5,,",
  "mods": {},
  "code": {
    "instruct": "<!--\n/*  Collector (Garcia, Kornell, Kerr, Blake & Haffey)\n    A program for running experiments on the web\n    Copyright 2012-2016 Mikey Garcia & Nate Kornell\n\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU General Public License version 3 as published by\n    the Free Software Foundation.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU General Public License for more details.\n\n    You should have received a copy of the GNU General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>\n \t\t\n\t\tKitten/Cat release (2019-2021) author: Dr. Anthony Haffey (team@someopen.solutions)\t\t\n*/\n-->\n<style>\n#instruct_text{\n  margin:auto;\n  width:500px;\n  padding:50px;\n  max-height:600px;\n  text-align: center;  \n}\n#proceed_button{\n  position:absolute;\n  right: 20px;\n}\n#trial_contents{\n  position: absolute;\n  top:0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  margin:auto;\n  width:600;\n  height:600;\n}\n</style>\n<div id=\"trial_contents\">\n  <div id=\"instruct_text\">{{text}}</div>\n  <div>\n    <button class=\"btn btn-primary\" id=\"proceed_button\" onclick=\"Phase.submit()\">Proceed</button>\n  </div>\n</div>",
    "magic_recall": "<style>\n.McButton{\n  display: center;\n  text-align: center;\n  margin-top: 15px;\n}\n.answerBox{\n      margin: auto;\n    text-align:center;\n    display: center;\n}\n.pic{\n    margin: auto;\n    text-align:center;\n    display: center;\n}\n#content {\n  width: 90%;\n  max-width: 850px;\n  min-width: 600px;\n}\n.instruct {\n  font-size: 15px;\n  margin-top: 20px;\n  margin-bottom: 20px;\n}\n</style>\n\n\n<p>\n  <br><br></p><center>{{Text}}</center><br><br>\n<p></p>\n\n<!-- Show the image -->\n<div class=\"pic\">\n      <img height=\"720px\" src=\"{{Image}}\">\n</div>\n\n\n<!-- Show the text + answer box + submit button-->\n<div class=\"answerBox\">\n  \n  <p>{{Text}}</p>\n  <p>Please describe what has happened in this magic trick according to your memory.</p>\n  <p>If you cannot recall it, please write \"no recall\".</p>  \n  <input type=\"text\" id=\"trickAnswer\" name=\"trickAnswer\" class=\"collectorInput\" size=\"100%\">\n  \n  <input type=\"submit\" class=\"collectorButton collectorAdvance McButton\" id = \"submit\" name=\"submitButton\" onclick=\"Trial.submit()\" value=\"Submit\" style=\"display:none\">\n\n</div>\n\n\n\n\n\n\n<script>\n\nTrial.set_timer(function(){\n  $(\"#trickAnswer\").focus();\n},0)\n\n$(document).ready(function () {\n  $('#trickAnswer').on('input change', function () {\n    if ($(this).val() != '') {\n      $('#submit').show();\n    }\n    else {\n      $('#submit').hide();\n    }\n  });\n});\n</script>\n</body></html>",
    "magic_recognition": "<style>\nlabel {\n    display:table-row;\n    }\nlabel > div {\n    display:table-cell;\n}\n.pic {\n    margin: auto;\n    text-align:center;\n    display: center;\n    }\n.recognitiondiv {\n    margin: auto;\n    text-align:center;\n    display: center;\n    }\n.questiondiv { \n    font-size: 150%; \n    font-style: italic;\n    text-align: center;\n    }\n.answerdiv { \n    font-size: 120%; \n    color: #666;\n    }\n.recognitionAnswers { \n    text-align: left;\n    display: inline-block;\n    }\n.McButton {\n    text-align:center;\n    margin-top: 15px;\n    }\n.LikertArea {\n    width: 50%;\n    height: 25%;\n    margin-left: auto;\n    margin-right: auto;\n    }\n.LikertDescArea\t{\t\n    overflow: hidden;\n    margin-top: 10px;\n    }\n.LikertDesc\t{\t\n    color: #666;\n    font-size: 100%;\n    max-width: 72%;\n    display: inline-block;\n    }\n.LikertLeft\t{\t\n    float: left;\n    }\n.LikertRight {\t\n    float: right;\n    }\n.Likert\t{\t\n    display: inline-block;\n    text-align: center;\n    width: 16.6%;\n    font-size: 120%\n    }\n.Likert > label\t{\t\n    display: inline-block;\n    width: 100%;\n    }\n</style>\n\n<p>\n  <br><br></p><center>{{Text}}</center><br><br>\n</p>\n\n<!-- Show the image -->\n<div class=\"pic\">\n    <img height=\"720px\" src=\"{{Image}}\">\n</div>\n\n<!-- Recogntion: what happens in this trick? -->\n<div class=\"recognitiondiv maindiv\">\n  <div class=\"recognitionQuestion questiondiv\">What happens in this magic trick?</div>\n  <div class=\"recognitionAnswers answerdiv\">\n    <form action=\"\">\n      <ul class=\"recognitionAnswers\">\n          <label class=\"option_class op1\"><input type=\"radio\" name=\"recognitionRadio\" id=\"inp1\" value=\"1\"></label>\n          <label class=\"option_class op2\"><input type=\"radio\" name=\"recognitionRadio\" id=\"inp2\" value=\"2\"></label>\n          <label class=\"option_class op3\"><input type=\"radio\" name=\"recognitionRadio\" id=\"inp3\" value=\"3\"></label>\n          <label class=\"option_class op4\"><input type=\"radio\" name=\"recognitionRadio\" id=\"inp4\" value=\"4\"></label>\n      </ul>\n    </form>\n  </div>\n\n  <div class=\"McButton\">\n      <input type=\"button\" class=\"collectorButton responseButton recognitionButton\" name=\"recognitionButton\" value=\"Submit\" disabled=\"\">\n  </div>\n</div>\n\n<div class=\"confidencediv maindiv\" style=\"display: none;\">\n  <div class=\"insertConfidence\"></div>\n  <div class=\"McButton\">\n    <input type=\"button\" class=\"collectorButton responseButton confidenceButton\" name=\"confidenceButton\" value=\"Submit\" disabled=\"\">\n  </div>\n</div>\n\n\n<input type = \"text\" name= \"Recognition_chosen\" id =\"Recognition_chosen\" style=\"display: none;\">\n<input type = \"text\" name= \"Confidence\" id =\"Confidence\" style=\"display: none;\"> \n\n<button class=\"collectorButton nextTrial\" style=\"display: none;\">Submit</button>  \n\n<input type=\"hidden\" name=\"recognition_RT\" id=\"recognition_RT\">\n<input type=\"hidden\" name=\"confidence_RT\" id=\"confidence_RT\">\n\n\n<script>\nconfidenceScale = prepareLikert( 'Confidence', ['How confident are you regarding your answer?', 'Not confident at all', 'Very confident']);\n\nfunction prepareLikert( name, text ) {\nlikertScale = '';\nfor( i = 1; i < 7; i++ ) {\n    likertScale = likertScale +'<span class=\"Likert\"><label><input name=\"'+ name +'\" type=\"radio\" value=\"'+ i +'\" /><br />'+ i +'</label></span>';\n}\nlikertScale =\n    '<div class=\"LikertArea maindiv'+ name +'\">'+\n        '<span class=\"LikertQuestion questiondiv\"><center> '+ text[0] +'</center></span>'+\n        '<div class=\"LikertDescArea answerdiv '+ name +'Answers\">'+\n            '<span class=\"LikertDesc LikertLeft\">'+\n                text[1]+\n            '</span>'+\n            '<span class=\"LikertDesc LikertRight\">'+\n                text[2]+\n            '</span>'+\n        '</div>'+\n        '<div class=\"LikertScale\">'+\n            likertScale+\n        '</div>'+\n    '</div>';\nreturn likertScale;\n}\n\nfunction shuffle(array) {\n  var tmp, current, top = array.length;\n  if(top) while(--top) {\n    current = Math.floor(Math.random() * (top + 1));\n    tmp = array[current];\n    array[current] = array[top];\n    array[top] = tmp;\n  }\n  return array;\n}    \n\nvar myArray1 = [\"{{option1}}\",\"{{option2}}\",\"{{option3}}\",\"{{option4}}\"];\nshuffle(myArray1);\n\n//Prepare Scales and Images\n\nbaseline_time = (new Date()).getTime();            \n\n$(\".insertConfidence\").append(confidenceScale); \n\n$(\".op1\").append(myArray1[0]); \n$('#inp1').val(myArray1[0]);\n\n$(\".op2\").append(myArray1[1]); \n$('#inp2').val(myArray1[1]);\n\n$(\".op3\").append(myArray1[2]); \n$('#inp3').val(myArray1[2]);\n\n$(\".op4\").append(myArray1[3]); \n$('#inp4').val(myArray1[3]);\n\ndelayTime = 800;\n\n\n//enable Submit-Button when a radio button gets selected\n$(\"input[type='radio']\").on(\"click\", function() {\n    $(this).closest(\".maindiv\").find(\"input[type='button']\").prop(\"disabled\",false);\n});\n    \n//when recognition button is pressed, let the question vanish and the curiosity one appear\n$(\"input[name='recognitionButton']\").on(\"click\", function() {\n    var this_RT = (new Date()).getTime() - baseline_time ;\n    $(\"#recognition_RT\").val(this_RT);\n            console.log('RT recognition : '+$(\"#recognition_RT\").val())\n    $(\"#Recognition_chosen\").val($('input[name=recognitionRadio]:checked').val());\n            console.log('recognition answer: '+$(\"#Recognition_chosen\").val())\n\t$(\".recognitiondiv\").hide();\n\t$(\".pic\").hide();\n\tsetTimeout( function() {\n\t\t$(\".confidencediv\").show();\n\t\t}, delayTime );\n\tbaseline_time = (new Date()).getTime();            \n});\n\t\t\n//when confidence button is pressed, let collect the responses and move on to the next trial\n$(\"input[name='confidenceButton']\").on(\"click\", function() {\n    var this_RT = (new Date()).getTime() - baseline_time ;\n    $(\"#confidence_RT\").val(this_RT);\n    $(\"#Confidence\").val($('input[name=Confidence]:checked').val());\n        console.log('Confidence rating: '+$(\"#Confidence\").val())\n    $(\".collectorAdvance\").click();\n    Trial.submit()\n});\n\n</script>\n",
    "survey": "<!--\r\n  Author: Dr. Anthony Haffey\r\n\r\n  Collector: Cat/Kitten/Cat release\r\n  A program for running experiments on the web\r\n  Copyright 2012-2018 Mikey Garcia & Nate Kornell\r\n\r\n  This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License version 3 as published by the Free Software Foundation.\r\n\r\n  This program is distributed in the hope that it will be useful,\r\n  but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n  GNU General Public License for more details.\r\n\r\n  You should have received a copy of the GNU General Public License\r\n  along with this program.  If not, see <http://www.gnu.org/licenses/>\r\n\r\n  Kitten/Cat release (2019-2021) author: Dr. Anthony Haffey\r\n\r\n  (team@someopen.solutions)\r\n-->\r\n<style>\r\nbody{\r\n  background-color:#5F9EA0;\r\n  width:100%;\r\n  height:100%;\r\n}\r\ntd{\r\n  padding:10px;\r\n  vertical-align: top;\r\n}\r\n\r\n/*\r\n*\telements by id\r\n*/\r\n\r\n#content{\r\n  width:95%;\r\n}\r\n#proceed_button{\r\n  display:none;\r\n  float:right;\r\n}\r\n#survey_outline{\r\n\tposition: \t\t\t\t\tfixed;\r\n  top: \t\t\t\t\t\t\t\t50%;\r\n  left: \t\t\t\t\t\t\t50%;\r\n\theight: \t\t\t\t\t\t90%;\r\n\toverflow: \t\t\t\t\tauto;\r\n\t-webkit-transform: \ttranslate(-50%, -50%);\r\n  transform: \t\t\t\t\ttranslate(-50%, -50%);\r\n  background-color: \twhite;\r\n\tmin-width:        \t900px;\r\n\tmax-width:        \t9000px;\r\n\tborder-radius:    \t20px;\r\n  border-color:     \t#069;\r\n  border-style:     \tsolid;\r\n  border-width:     \t5px;\r\n\tpadding:            10px;\r\n  box-shadow:         12px 12px 12px rgba(0, 0, 0, 0.5);  \r\n}\r\n#survey_tabs{\r\n  padding:            20px;\r\n}\r\n#this_survey_id{\r\n  padding:            20px;\r\n  display:            none;\r\n}\r\n\r\n/*\r\n*\telements by class\r\n*/\r\n.feedback_span_multiple{\r\n  display: none;\r\n  margin:  10px;\r\n}\r\n.feedback_span_single{\r\n  display: none;\r\n  padding: 10px;\r\n}\r\n.likert_table td{\r\n  padding:    1px;\r\n  text-align: center;\r\n}\r\n.likert_table td:hover{\r\n  color: blue;\r\n}\r\n.score_total{\r\n  display: none;\r\n}\r\n.show_tab{\r\n  margin: 5px;\r\n}\r\n.survey_btn{\r\n\twhite-space: normal;\r\n\tword-wrap: \t initial;\r\n}\r\n.table_break{\r\n\twidth:    100%;\r\n\theight:   300px;\r\n\toverflow: auto;\r\n}\r\n\r\n\r\n/*\r\n* by Bora Alp Arat at https://stackoverflow.com/questions/21684101/css-vertical-scrollbar-padding-left-right-in-ul-possible\r\n*/\r\n::-webkit-scrollbar {\r\n  width: 14px;\r\n  height: 18px;\r\n}\r\n::-webkit-scrollbar-thumb {\r\n  height: 6px;\r\n  border: 4px solid rgba(0, 0, 0, 0);\r\n  background-clip: padding-box;\r\n\t-webkit-border-radius: 7px;\r\n  background-color: rgba(0, 102, 153, 0.5);\r\n  -webkit-box-shadow: inset -1px -1px 0px rgba(0, 0, 0, 0.05), inset 1px 1px 0px rgba(0, 0, 0, 0.05);\r\n}\r\n::-webkit-scrollbar-button {\r\n  width: 0;\r\n  height: 0;\r\n  display: none;\r\n}\r\n::-webkit-scrollbar-corner {\r\n  background-color: transparent;\r\n}\r\n</style>\r\n<div id=\"everything\">\r\n\t<div id=\"survey_outline\"></div>\r\n</div>\r\n<span id=\"scales_span\"></span>\r\n<script>\r\n/*\r\n* Retrieving settings\r\n*/\r\n\r\nif(typeof(settings) !== \"undefined\"){\r\n  settings = [settings];\r\n} else {\r\n  settings = {};\r\n}\r\n\r\n/*\r\n* vertical vs. horizontal tabs\r\n*/\r\n\r\nif(typeof(settings.tab_hor_vert) == \"undefined\" || settings.tab_hor_vert.toLowerCase() == \"horizontal\"){\r\n  settings.tab_hor_vert = \"horizontal\";\r\n  var please_wait = $(\"<div>\");\r\n  var this_survey = $(\"<div>\");\r\n  var survey_tabs = $(\"<div>\");\r\n  var proceed_btn = $(\"<input>\");\r\n  please_wait.attr(\"id\", \"please_wait_div\")\r\n             .html(\"Loading... Please wait\");\r\n  this_survey.addClass(\"needs-validation\")\r\n             .attr(\"id\", \"this_survey_id\")\r\n             .attr(\"novalidate\", true);\r\n  survey_tabs.attr(\"id\", \"survey_tabs\")\r\n             .addClass(\"border-top\")\r\n             .addClass(\"border-primary\")\r\n             .css(\"text-align\", \"right\")\r\n  proceed_btn.addClass(\"btn\")\r\n             .addClass(\"btn-primary\")\r\n             .attr(\"id\", \"proceed_button\")\r\n             .attr(\"type\", \"submit\")\r\n             .attr(\"value\", \"Proceed\")\r\n  $(\"#survey_outline\").append(please_wait)\r\n                      .append(this_survey)\r\n                      .append(survey_tabs)\r\n                      .append(proceed_btn);\r\n\r\n} else if (settings.tab_hor_vert.toLowerCase() == \"vertical\"){\r\n  $(\"#survey_outline\").html(\r\n    '<table>' +\r\n      '<tr>' +\r\n        '<td valign=\"top\" class=\"border-right border-primary\">'+\r\n          '<div id=\"survey_tabs\"></div>' +\r\n        '</td>' +\r\n        '<td>'+\r\n          '<div id=\"please_wait_div\">Please wait while survey is downloading</div>'+\r\n          '<div id=\"this_survey_id\" class=\"needs-validation\" novalidate></div>' +\r\n          '<input type=\"button\" value=\"Proceed\" class=\"btn btn-primary\" id=\"proceed_button\">'+\r\n        '</td>'+\r\n      '</tr>'+\r\n    '</table>'\r\n  );\r\n} else if(settings.tab_hor_vert.toLowerCase() == \"none\"){\r\n  $(\"#survey_outline\").html(\r\n    '<div id=\"survey_tabs\" style=\"display:none\"></div>' +\r\n    '<div id=\"please_wait_div\">Please wait while survey is downloading</div>'+\r\n    '<div id=\"this_survey_id\" class=\"needs-validation\" novalidate></div>'\r\n  );\r\n} else {\r\n  bootbox.alert(\"If you are the researcher, please check the 'settings for this survey. The input for 'tab_hor_vert' appears to be invalid. Please change it to 'horizontal' or 'vertical' or 'none' or remove 'tab_hot_vert' altogether from the settings, which will make the tabs invisible\");\r\n}\r\n\r\n/*\r\n* Defining objects\r\n*/\r\n\r\npage_break_management = {\r\n  breaks_remaining : 0,\r\n  breaks_index     : 0\r\n}\r\n\r\nproceed_object = {\r\n  type:[],\r\n  name:[],\r\n  break_no:[]\r\n};\r\n\r\nscoring_object={\r\n  scales:[],\r\n  scale_scores:[],\r\n  update_scales:function(this_survey){\r\n    headers = Object.keys(this_survey[0]);\r\n    this.scales = headers.filter(elm => elm.includes(\"score:\"));\r\n    var scales_html = '';\r\n    this.scales.forEach(function(element){\r\n      element = element.replace(\": \",\":\");\r\n      scales_html += \"<input name='\"+element.replace(/ |:/g,\"_\")+\"' class='score_total \"+element.replace(/ |:/g,\"_\")+\"' disabled>\";\r\n    });\r\n    $(\"#scales_span\").html(scales_html);\r\n  }\r\n}\r\n\r\nsurvey_obj = {};\r\n\r\n/*\r\n* Element actions\r\n*/\r\n\r\n/*\r\n$(function() {\r\n  $( \".datepicker\" ).datepicker({\r\n    dateFormat : 'mm/dd/yy',\r\n    changeMonth : true,\r\n    changeYear : true,\r\n    yearRange: '-100y:c+nn',\r\n    maxDate: '-1d'\r\n  });\r\n});\r\n*/\r\n\r\n\r\n$('#ExperimentContainer').css('transform','scale(1,1)');\r\n\r\n$(\"#proceed_button\").on(\"click\",function(){\r\n  var proceed = true;\r\n  var tabs    = document.getElementsByClassName('show_tab active');\r\n  if(tabs.length > 0){\r\n    var current_tab       = document.getElementsByClassName(\r\n      'show_tab active')[0]\r\n        .id\r\n        .replace(\"_button\", \"\")\r\n        .replace(\"tab_\",    \"\");\r\n    var response_elements = $('#table_'+current_tab).find('.response_element');\r\n\r\n  } else {\r\n    response_elements = $(\".table_break:visible\").find(\".response_element\");\r\n  }\r\n\r\n  for(var i = 0; i < response_elements.length; i++){\r\n    [row_no,item_name] = retrieve_row_no_item_name(response_elements[i]);\r\n    var this_optional = survey_obj.data[row_no].optional.toLowerCase();\r\n\r\n    if(this_optional.indexOf(\"no\") !== -1){\r\n      this_optional = this_optional.split(\"-\");       // find out whether there's a minimal number of responses\r\n      if(this_optional.length == 1){                  // default is that length needs to be at least 1\r\n        var min_resp_length = 1;\r\n      } else if(this_optional.length == 2) {\r\n        var min_resp_length = this_optional[1];\r\n      } else {\r\n        bootbox.alert(\"Error - you appear to have too many '-' characters in the 'optional' column\");\r\n        return false;\r\n      }\r\n    } else {\r\n      min_resp_length = 0;\r\n    }\r\n\r\n    var quest_resp = isJSON($(\"#\"+response_elements[i].id).val());\r\n    if (quest_resp.length < min_resp_length){\r\n      proceed = false;\r\n\t\t\t$(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-dark\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-success\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).addClass(\"text-danger\");\r\n    } else {\r\n\t\t\t$(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-dark\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).removeClass(\"text-danger\");\r\n      $(\"#\"+response_elements[i].id.replace(\"response\",\"question\")).addClass(\"text-success\");\r\n    }\r\n  }\r\n\r\n  if(current_tab == survey_obj.tabs && proceed){\r\n    if(typeof(sql_surveys) == \"undefined\"){\r\n      //$(\".table_break\");\r\n      var next_table_no = parseFloat($(\".table_break:visible\")[0].id.replace(\"table\",\"\")) + 1;\r\n\r\n      if($(\".table_break#table\"+next_table_no).length == 0){\r\n        if(typeof(Phase) !== \"undefined\"){\r\n          Phase.submit();\r\n        } else {\r\n          bootbox.alert(\"You've finished! Click on the preview button to restart.\")\r\n        }\r\n      } else {\r\n        $(\".table_break\").hide();\r\n        $(\".table_break#table\" + next_table_no).show();\r\n      }\r\n    } else {\r\n      $(\"#survey_outline\").html(\"<h1> You have finished the preview of this survey.</h1>\");\r\n    }\r\n  } else if(current_tab < survey_obj.tabs && proceed) {\r\n    current_tab ++;\r\n    $(\"#tab_\"+current_tab+\"_button\").removeClass(\"btn-secondary\");\r\n    $(\"#tab_\"+current_tab+\"_button\").removeClass(\"disabled\");\r\n    $(\"#tab_\"+current_tab+\"_button\").addClass(\"btn-outline-dark\");\r\n    $(\"#tab_\"+current_tab+\"_button\").click();\r\n  } else if(proceed == false){\r\n    bootbox.alert(\"You're missing some responses. Please fill in all the answers for the questions in red above.\");\r\n  } else if(current_tab > survey_obj.tabs){\r\n    bootbox.alert(\"Error - please contact Scientific Open Solutions about this problem, error 'Survey_001'.\");\r\n  }\r\n});\r\n\r\n//by qwerty at https://stackoverflow.com/questions/2116558/fastest-method-to-replace-all-instances-of-a-character-in-a-string\r\nString.prototype.replaceAll = function(str1, str2, ignore){\r\n  return this.replace(new RegExp(str1.replace(/([\\/\\,\\!\\\\\\^\\$\\{\\}\\[\\]\\(\\)\\.\\*\\+\\?\\|\\<\\>\\-\\&])/g,\"\\\\$&\"),(ignore?\"gi\":\"g\")),(typeof(str2)==\"string\")?str2.replace(/\\$/g,\"$$$$\"):str2);\r\n}\r\n\r\n\r\n/*\r\nFunctions\r\n*/\r\n\r\nfunction clean_item(this_item){\r\n  if(this_item.indexOf(\"'\") !== -1 |\r\n     this_item.indexOf('\"') !== -1){\r\n    bootbox.alert(\"Please avoid apostraphes or quote marks in the responses the participant can give. These cause problems with smooth running of surveys. This occurs when you wrote:<br><br>\" + this_item);\r\n  }\r\n  return(this_item);\r\n}\r\n\r\nfunction generate_feedback_string(feedback_array, this_index, feedback_color, row){\r\n  if(feedback_array){                 //i.e. if it's not null\r\n    if(feedback_array.length > 1){\r\n      return \"<div class='feedback_span_multiple \"+row[\"item_name\"].toLowerCase()+\"_feedback' style='color:\"+feedback_color[this_index]+\"'>\"+feedback_array[this_index]+\"</div>\";\r\n    } else {\r\n      return \"<div class='feedback_span_single \" +\r\n      row[\"item_name\"].toLowerCase() + \"_feedback' style='color:\" +\r\n      feedback_color[this_index] +\r\n      \"'>\" +\r\n      feedback_array[this_index] +\r\n      \"</div>\";\r\n    }\r\n  } else {\r\n    return \"\";\r\n  }\r\n}\r\n\r\nfunction get_feedback(row){\r\n  if(typeof(row[\"feedback\"]) !== \"undefined\" && row[\"feedback\"] !== \"\"){\r\n    feedback_array = row[\"feedback\"].split(\"|\");\r\n    if(typeof(row[\"feedback_color\"]) == \"undefined\"){\r\n      bootbox.alert(\"The color for the feedback options has not been set. If you created this questionnaire, please add a column 'feedback_color' to your survey and separate the colors by a pipe (|) character.\");\r\n    }\r\n    feedback_color = row[\"feedback_color\"].split(\"|\");\r\n  } else {\r\n    feedback_array = null;\r\n    feedback_color = '';\r\n  }\r\n  return [feedback_array,feedback_color];\r\n}\r\n\r\nfunction isJSON(str) {\r\n  try {\r\n    return JSON.parse(str);\r\n  } catch (e) {\r\n    return str;\r\n  }\r\n}\r\n\r\nfunction likert_update(this_element){\r\n\r\n  [row_no,item_name] = retrieve_row_no_item_name(this_element);\r\n\r\n  $(\".row_\"+row_no).removeClass(\"active\");\r\n  $(\".row_\"+row_no).removeClass(\"btn-primary\");\r\n  $(\".row_\"+row_no).addClass(\"btn-outline-primary\");\r\n  $(this_element).removeClass(\"btn-outline-primary\");\r\n  $(this_element).addClass(\"btn-primary\");\r\n  $(\"#survey_\"+item_name+\"_response\").val(this_element.value);\r\n  response_check(this_element);\r\n}\r\n\r\nfunction load_survey(survey){\r\n  /*\r\n  * are we in preview?\r\n  */\r\n  if(typeof(parent.collector_survey_preview) !== \"undefined\"){\r\n    survey_content = survey;\r\n  } else if(typeof(parent.master) !== \"undefined\" && parent.master.surveys.preview){\r\n    survey_content = survey;\r\n    survey_obj.mods = parent.master.mods;\r\n  } else {\r\n    survey = survey.toLowerCase().replace(\".csv\",\"\") + \".csv\";\r\n\r\n    if(typeof(parent.parent.project_json.surveys) !== \"undefined\" &&\r\n       typeof(parent.parent.project_json.surveys[survey]) !== \"undefined\"){\r\n      survey_content = parent.parent.project_json.surveys[survey];\r\n      survey_obj.mods = parent.parent.project_json.mods;\r\n\r\n    } else if(\r\n      typeof(parent.parent.project_json.surveys) !== \"undefined\" &&\r\n      typeof(parent.parent.project_json.surveys[\r\n        survey.replace(\".csv\",\"\")\r\n      ])\r\n    ){\r\n\t\t\tsurvey_content = parent.parent.project_json.surveys[survey.replace(\".csv\",\"\")];\r\n      survey_obj.mods = parent.parent.project_json.mods;\r\n\t\t}\telse {\r\n      bootbox.alert(\"Survey \" + survey  + \" doesn't appear to exist\");\r\n    }\r\n  }\r\n  process_returned_questionnaire(survey_content);\r\n}\r\n\r\nfunction process_question(row, row_no){\r\n  row.values = row.values == \"\" ? row.answers : row.values;\r\n  if(row_check(\"page_break\", row)){\r\n    page_break_management.breaks_remaining++;\r\n    question_td = \"</tr></table><table id='table\" +\r\n      page_break_management.breaks_remaining +\r\n      \"' style='display:none' class='table_break'></tr>\";\r\n  } else {\r\n    if(\r\n      typeof(row[\"values\"]) !== \"undefined\" & typeof(row[\"values\"]) !== \"function\"\r\n    ){ //to address microsoft edge issue.\r\n      value_array = row[\"values\"].split(\"|\");\r\n    } else {\r\n      value_array='';\r\n    }\r\n\r\n    if(row[\"item_name\"].indexOf(\" \") !== -1){\r\n      bootbox.alert(\"Please note that the 'item name' '\" +\r\n        row['item_name'] +\r\n        \"' is invalid because it has at least one space. Please use underscores instead of spaces. If you're not the creator of this task, please contact the person who created it.\"\r\n      );\r\n    }\r\n\r\n    /*\r\n    * class for scoring\r\n    */\r\n\r\n    var this_class = \"\";\r\n    for(var i=0;i<scoring_object.scales.length;i++){\r\n      if(row[scoring_object.scales[i].toLowerCase()]==\"1\"){\r\n        this_class += scoring_object.scales[i].toLowerCase().replace(\r\n          \"score: \",\"\"\r\n        ).replace(/ |-/,\"\") + \" \";\r\n      }\r\n      if(row[scoring_object.scales[i].toLowerCase()]==\"r1\"){\r\n        this_class += scoring_object.scales[i].toLowerCase().replace(\"score: \",\"\").replace(\" \",\"_\")+\"-r1 \";\r\n      }\r\n    }\r\n\r\n    /*\r\n    * adding to row to help with \"write\" function\r\n    */\r\n    var row_x = JSON.parse(\r\n      JSON.stringify(row)\r\n    );\r\n    row_x[\"row_no\"] = row_no;\r\n    row_x[\"this_class\"] = this_class;\r\n\r\n    [feedback_array,feedback_color] = get_feedback(row);\r\n\r\n\r\n    question_td = '<input type=\"hidden\" class=\"response_element row_' + row_no + '\" id=\"survey_' +\r\n      row[\"item_name\"].toLowerCase() +\r\n      '_response\" name=\"survey_' +\r\n      row[\"item_name\"].toLowerCase() +\r\n      '_response\" value=\"\">';\r\n\r\n    /*\r\n    * Survey settings\r\n    */\r\n    [row_ques_perc,row_resp_perc] = row_perc(row[\"question_width\"]);\r\n\r\n    if(typeof(settings.feedback_before_response) == \"undefined\"){\r\n      settings.feedback_before_response = true;\r\n    }\r\n\r\n    if(typeof(settings.lock_after_feedback) == \"undefined\"){\r\n      settings.lock_after_feedback = false;\r\n    }\r\n\r\n    if(typeof(row[\"type\"]) == \"undefined\"){\r\n      return false;\r\n    }\r\n\r\n    if(\r\n      typeof(survey_obj.mods) !== \"undefined\" &&\r\n\t\t\ttypeof(survey_obj.mods[row.type]) !== \"undefined\"\r\n    ){\r\n      var mod_html = survey_obj.mods[row.type].contents;\r\n\r\n      Object.keys(row).forEach(function(attribute){\r\n        mod_html = mod_html.replaceAll(\"{{\"+attribute+\"}}\",row[attribute]);\r\n      });\r\n      question_td += mod_html;\r\n    } else {\r\n      switch(row[\"type\"].toLowerCase()){\r\n        case \"page_start\":\r\n          var tabs_html = $(\"#survey_tabs\").html();\r\n          if(settings.tab_hor_vert == \"horizontal\"){\r\n            span_div = \"span\";\r\n          } else if(settings.tab_hor_vert == \"vertical\"){\r\n            span_div = \"div\";\r\n          }\r\n          if(typeof(survey_obj.tabs) == \"undefined\"){\r\n            survey_obj.tabs = 0;\r\n          } else {\r\n            survey_obj.tabs++;\r\n          }\r\n          if(survey_obj.tabs == 0){ //i.e. is the first tab\r\n            active_button = \"btn-outline-primary active\";\r\n          } else {\r\n            active_button = \"btn-secondary disabled\";\r\n          }\r\n          if(settings.tab_hor_vert == \"vertical\"){\r\n            var vert_btn_block = \"btn-block\";\r\n          } else {\r\n            var vert_btn_block = \"\";\r\n          }\r\n\r\n          tabs_html +=  '<'+span_div+' class=\"btn-group-toggle\" data-toggle=\"buttons\">'+\r\n            '<label id=\"tab_' + survey_obj.tabs + '_button\" class=\"btn show_tab '+active_button+' '+vert_btn_block+'\">'+\r\n              '<input type=\"checkbox\" checked autocomplete=\"off\">'+ row['text'] +\r\n            '</label>'+\r\n          '</'+span_div+'>';\r\n\r\n          $(\"#survey_tabs\").html(tabs_html);\r\n\r\n          page_break_indexes = [];\r\n          survey_obj.data.forEach(function(row,this_index){\r\n            if(typeof(row.type) !== \"undefined\" && row.type.toLowerCase() == \"page_start\"){\r\n              page_break_indexes.push(this_index);\r\n            }\r\n          });\r\n\r\n          if(survey_obj.tabs > 0){\r\n            question_td += \"</td><td></td></tr></table></div><div class='survey_page' id='tab_\" + survey_obj.tabs + \"' style='display:none'><table id='table_\" + survey_obj.tabs + \"' class='table_break'><tr>\";\r\n          } else {\r\n            question_td += \"</td><td></td></tr></table><div class='survey_page' id='tab_\"+survey_obj.tabs+\"' ><table id='table_\"+survey_obj.tabs+\"' class='table_break'><tr>\";\r\n          }\r\n          break;\r\n        case \"checkbox\":\r\n        case \"checkbox_vertical\":\r\n          question_td += write(\"checkbox_vertical\",row_x);\r\n          break;\r\n        case \"checkbox_horizontal\":\r\n          question_td += write(\"checkbox_horizontal\",row_x);\r\n          break;\r\n        case \"checkbox_single\":\r\n          question_td += write(\"checkbox_single\", row_x);\r\n          break;\r\n        case \"date\":\r\n          question_td += write(\"date\",row_x);\r\n        break;\r\n        case \"dropdown\":\r\n\t\t\t\tcase \"select\":\r\n          question_td += write(\"dropdown\",row_x);\r\n        break;\r\n        case \"email\":\r\n          question_td += write(\"email\", row_x);\r\n        break;\r\n        case \"google_slide\":\r\n        case \"jumbled\":\r\n        case \"instruct\":\r\n          // these are defined elsewhere to take the whole row\r\n          break;\r\n        case \"likert\":\r\n          question_td += write(\"likert\", row_x);\r\n        break;\r\n        case \"number\":\r\n          question_td += write(\"number\", row_x);\r\n          break;\r\n        case \"para\":\r\n          question_td += write(\"para\", row_x);\r\n          break;\r\n        case \"radio\":\r\n        case \"radio_vertical\":\r\n          question_td += write(\"radio_vertical\", row_x);\r\n          break;\r\n        case \"radio_horizontal\":\r\n          question_td += write(\"radio_horizontal\", row_x);\r\n        break;\r\n\r\n        case \"report_score\":\r\n            question_td += \"<input disabled class='form-control score_\" + row[\"item_name\"] + \" \"+row[\"item_name\"]+\"_item row_\"+row_no+\"' type='text' name='survey_\"+row['item_name'].toLowerCase()+\"'>\";\r\n        break;\r\n\r\n        case \"text\":\r\n          question_td += write(\"text\", row_x);\r\n        break;\r\n      }\r\n    }\r\n    if(feedback_array){\r\n        question_td += \"<button class='btn btn-outline-info feedback_btn \"+row[\"item_name\"]+\"_item row_\"+row_no+\"' data-toggle='tooltip' id='reveal_\"+row[\"item_name\"].toLowerCase()+\"_feedback' onclick='reveal_answers(this)'>Show</button>\";\r\n    }\r\n  }\r\n  if(typeof(row[\"type\"])== \"undefined\"){\r\n      return '';\r\n  } else {\r\n    if(row[\"type\"].toLowerCase() == \"instruct\"){\r\n      row_html  = write(\"instruct\",row);\r\n    } else if(row[\"type\"].toLowerCase() == \"jumbled\"){\r\n      //row_html  = question_td + write(\"jumbled\",row); <-- this is better, but being paused for placement work Anthony is doing\r\n      row_html  = write(\"jumbled\",row);\r\n\t\t} else if(row[\"type\"].toLowerCase() == \"likert\"){\r\n\r\n\t\t\tif(typeof(row[\"side_by_side\"]) !== \"undefined\" &&\r\n\t\t\t\t row[\"side_by_side\"].toLowerCase() == \"yes\"){\r\n\r\n\t\t\t\tvar row_html=\"<td class='text-primary' id='survey_\"+row[\"item_name\"].toLowerCase().replace(\" \",\"_\")+\"_question' style='width:\"+row_ques_perc+\"; text-align:right'>\"+row[\"text\"]+\"</td><td>\"+question_td+\"</label></td>\";\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar row_html = \"<tr>\" +\r\n\t\t\t\t\t\t\"<td colspan='2'>\" +\r\n\t\t\t\t\t\t\trow[\"text\"] +\r\n\t\t\t\t\t\t\"</td>\" +\r\n\t\t\t\t\t\"</tr>\" +\r\n\t\t\t\t\t\"<tr>\" +\r\n\t\t\t\t\t\t\"<td colspan='2' align='center'>\" +\r\n\t\t\t\t\t\t\tquestion_td +\r\n\t\t\t\t\t\t\"</td>\" +\r\n\t\t\t\t\t\"</tr>\";\r\n\t\t\t}\r\n\r\n\r\n    } else if(row[\"type\"].toLowerCase()==\"google_slide\") {\r\n      var row_html=\"<td colspan='2'>\"+row[\"text\"]+\"</label></td>\";\r\n    } else if(typeof(row[\"no_text\"]) !== \"undefined\" && row[\"no_text\"] == \"on\"){\r\n      var row_html=\"<td colspan='2'>\"+question_td+\"</td>\";\r\n    } else {\r\n      if(row['text'].toLowerCase() == \"page_start\" | row['type'].toLowerCase() == \"page_start\"){\r\n        row_html = question_td;\r\n      } else {\r\n        var row_html=\"<td class='text-primary' id='survey_\"+row[\"item_name\"].toLowerCase().replace(\" \",\"_\")+\"_question' style='width:\"+row_ques_perc+\"; text-align:right'>\"+row[\"text\"]+\"</td><td>\"+question_td+\"</label></td>\";\r\n      }\r\n    }\r\n    if(typeof(row[\"optional\"]) !== \"undefined\"){\r\n      if(row[\"optional\"].toLowerCase() == \"no\"){\r\n        proceed_object.name.push(row[\"item_name\"]);\r\n        proceed_object.type.push(row[\"type\"]);\r\n        proceed_object.break_no.push(page_break_management.breaks_remaining);\r\n      }\r\n    }\r\n    if(typeof(row[\"shuffle_question\"]) == \"undefined\" || row[\"shuffle_question\"].toLowerCase() == \"off\"){\r\n      this_shuffle='none';\r\n    } else {\r\n      this_shuffle=row[\"shuffle_question\"];\r\n    }\r\n    return [row_html,this_shuffle];\r\n  }\r\n}\r\n\r\nfunction process_score(row_no, values_col, this_response, item, values_reverse ){\r\n  item_values = survey_obj.data[row_no][values_col].split(\"|\");\r\n  if(typeof(values_reverse) !== \"undefined\" && values_reverse == \"r\"){\r\n    item_values.reverse();\r\n  }\r\n  item_answers      = survey_obj.data[row_no][\"answers\"].split(\"|\");\r\n  var this_value    = item_values[item_answers.indexOf(this_response)];\r\n  $(\"#survey_\" + item + \"_score\").val(this_value);\r\n  if(typeof(this_value) !== \"undefined\"){\r\n    return parseFloat(this_value);\r\n  }\r\n}\r\n\r\nfunction process_returned_questionnaire(data){\r\n  survey_obj.data = data;\r\n  survey_obj.data = Papa.parse(\r\n    Papa.unparse(survey_obj.data),{\r\n      header:true,\r\n      beforeFirstChunk: function(chunk) {\r\n        var rows = chunk.split( /\\r\\n|\\r|\\n/ );\r\n        var headings = rows[0].toLowerCase();\r\n        rows[0] = headings;\r\n        return rows.join(\"\\r\\n\");\r\n      },\r\n    }\r\n  ).data;\r\n  survey_obj.scales = {};\r\n  var col_headers = Object.keys(survey_obj.data[0]);\r\n  col_headers.forEach(function(header){\r\n    if(header.indexOf(\"score:\")==0){\r\n      var original_header = header;\r\n      header = header.replace(\"score: \",\"\");\r\n      header = header.replace(\"score:\",\"\");\r\n      survey_obj.scales[header] = {};\r\n      survey_obj.scales[header].questions = {};\r\n\r\n      for(var i = 1; i < survey_obj.data.length; i++){\r\n        row = survey_obj.data[i];\r\n        if(row[original_header] !== \"\" && typeof(row[original_header]) !== \"undefined\"){\r\n          survey_obj.scales[header].questions[i] = row[original_header];\r\n        }\r\n      }\r\n    }\r\n  });\r\n  write_survey(survey_obj.data,\"this_survey_id\");\r\n  $(\"#please_wait_div\").hide();\r\n  $(\"#proceed_button\").show();\r\n  $('html, body').animate({\r\n    scrollTop: $(\"#survey_outline\").offset().top\r\n  }, 1000);\r\n}\r\n\r\nfunction row_perc(this_rat){\r\n\tif(typeof(this_rat) == \"undefined\"){\r\n    row_resp_perc = \"50%\";\r\n    row_ques_perc = \"50%\";\r\n  } else {\r\n    row_resp_perc = parseFloat(100-this_rat.replace(\"%\",\"\"))+\"%\";\r\n    row_ques_perc = parseFloat(this_rat.replace(\"%\",\"\"))+\"%\";\r\n  }\r\n  return [row_ques_perc,row_resp_perc];\r\n}\r\n\r\nfunction response_check(submitted_element){\r\n  switch(submitted_element.type){\r\n    case \"checkbox\":\r\n\r\n      console.log(submitted_element);\r\n      console.log(submitted_element.name);\r\n\r\n\r\n\r\n      var checked_responses = $(\"[name='\"+submitted_element.name+\"']:checked\");\r\n      if(checked_responses.length){ //i.e. more than 0\r\n        var values = [];\r\n        for(var i = 0; i < checked_responses.length; i++){\r\n          values.push(checked_responses[i].value);\r\n        }\r\n        $(\"#\"+submitted_element.name+\"_response\").val(JSON.stringify(values));\r\n      } else {\r\n        $(\"#\"+submitted_element.name+\"_response\").val(\"\");\r\n      }\r\n      console.log($(\"#\"+submitted_element.name+\"_response\").val());\r\n      console.log($(\"#\"+submitted_element.name+\"_response\"));\r\n\r\n      break;\r\n\r\n      case \"button\":\r\n        $(\"#\" + submitted_element.name + \"_response\").val(\r\n          submitted_element.innerHTML\r\n        );\r\n      break;\r\n\r\n      case \"number\":\r\n      case \"radio\":\r\n      case \"select-one\":\r\n      case \"text\":\r\n      case \"textarea\":\r\n        $(\"#\" + submitted_element.name + \"_response\").val(\r\n          submitted_element.value\r\n        );\r\n      break;\r\n    }\r\n    update_score();\r\n}\r\n\r\nfunction retrieve_row_no_item_name(this_element){\r\n  var these_classes = this_element.className.split(\" \");\r\n  var row_no;\r\n  var item_name;\r\n  these_classes.forEach(function(this_class){\r\n    if (this_class.indexOf('row_') > -1) {\r\n      row_no = this_class.replace(\"row_\",\"\");\r\n    }\r\n    if (this_class.indexOf('_item') > -1) {\r\n      item_name = this_class.replace(\"_item\",\"\").toLowerCase();\r\n    }\r\n  });\r\n  return [row_no,item_name];\r\n}\r\n\r\nfunction reveal_answers(this_element){\r\n  var this_response = $(\"#\"+this_element.id.replace(\"reveal_\",\"survey_\").replace(\"_feedback\",\"_response\")).val();\r\n  response_present = this_response == \"\" ? false : true;\r\n\r\n  if(settings.feedback_before_response == false && response_present == false){\r\n    bootbox.alert(\"Please respond before trying reveal the feedback.\")\r\n  } else {\r\n    if($(\"#\"+this_element.id).hasClass(\"btn-outline-info\")){\r\n      $(\".\"+this_element.id.replace(\"reveal_\",\"\")).show(500);\r\n      if(settings.lock_after_feedback){\r\n        var item_class = this_element.id.replace(\"_feedback\",\"_item\").replace(\"reveal_\",\"\");\r\n        $(\".\"+item_class).prop(\"disabled\",true);\r\n        document.getElementsByClassName(item_class).title = \"The person creating this content has set it so that your answers are locked in once you have chosen to see the feedback\";\r\n        $(\"#\"+this_element.id).addClass(\"btn-info\");\r\n        $(\"#\"+this_element.id).removeClass(\"btn-outline-info\");\r\n        $(\"#\"+this_element.id).html(\"Locked\");\r\n        document.getElementById(this_element.id).title = 'The person creating this content has set it so that your answers are locked in once you have chosen to see the feedback';\r\n        $(\"#\"+this_element.id).addClass(\"disabled\");\r\n      } else {\r\n        $(\"#\"+this_element.id).html(\"Hide\");\r\n        $(\"#\"+this_element.id).removeClass(\"btn-outline-info\");\r\n        $(\"#\"+this_element.id).addClass(\"btn-info\");\r\n      }\r\n    } else {\r\n      $(\"#\"+this_element.id).html(\"Show\");\r\n      $(\".\"+this_element.id.replace(\"reveal_\",\"\")).hide(500);\r\n      $(\"#\"+this_element.id).addClass(\"btn-outline-info\");\r\n      $(\"#\"+this_element.id).removeClass(\"btn-info\");\r\n    }\r\n  }\r\n}\r\n\r\nfunction row_check(type, row){\r\n  if(type = \"page_break\"){\r\n    return (\r\n      typeof(row[\"text\"]) !== \"undefined\" &&\r\n\t\t  typeof(row[\"type\"]) !== \"undefined\" &&\r\n\t\t  row['text'].toLowerCase() == \"page_break\" |\r\n      row['type'].toLowerCase() == \"page_break\"\r\n    )\r\n\r\n  } else if(type=\"\"){\r\n\r\n  }\r\n}\r\n\r\n// http://stackoverflow.com/questions/962802#962890\r\nfunction shuffle(array) {\r\n  var tmp, current, top = array.length;\r\n  if(top) while(--top) {\r\n    current = Math.floor(Math.random() * (top + 1));\r\n    tmp = array[current];\r\n    array[current] = array[top];\r\n    array[top] = tmp;\r\n  }\r\n  return array;\r\n}\r\n\r\nfunction shuffle_answers(row){\r\n  if(\r\n    typeof(row[\"shuffle_answers\"]) !== \"undefined\" &&\r\n    row[\"shuffle_answers\"].toLowerCase() == \"yes\"\r\n  ){\r\n    var answers = row[\"answers\"].split(\"|\");\r\n    order = shuffle([...Array(answers.length).keys()]);\r\n\r\n    var ordered_answers = order.map(function(position){\r\n      return answers[position];\r\n    });\r\n    row[\"answers\"] = ordered_answers.join(\"|\");\r\n\r\n    if(row[\"values\"].indexOf(\"|\") !== -1){\r\n      var values = row[\"values\"].split(\"|\");\r\n      var ordered_values = order.map(function(position){\r\n        return values[position];\r\n      });\r\n      row[\"values\"] = ordered_values.join(\"|\");\r\n    }\r\n  }\r\n  return row;\r\n}\r\n\r\nfunction update_score(){\r\n  var scales = Object.keys(survey_obj.scales);\r\n  scales.forEach(function(scale){\r\n    this_scale = survey_obj.scales[scale];\r\n    var questions = Object.keys(this_scale.questions);\r\n    var this_score = 0;\r\n    complete_score = true;\r\n\r\n    questions.forEach(function(row_no){\r\n      var item = survey_obj.data[row_no].item_name.toLowerCase();\r\n      var this_response = $(\"#survey_\"+item+\"_response\").val(); //response\r\n      var normal_reverse = this_scale.questions[row_no];\r\n\r\n      if(normal_reverse.indexOf(\"-\") == -1){\r\n        var multiplier = parseFloat(normal_reverse.replace(\"r\",\"\"));\r\n        if(normal_reverse.indexOf(\"r\") == 0){ //reverse the values\r\n          this_value = process_score(row_no,\"values\",this_response,item,\"r\");\r\n        } else {\r\n          this_value = process_score(row_no,\"values\",this_response,item);\r\n        }\r\n      } else {\r\n        values_reverse = normal_reverse.split(\"-\");\r\n        values_col     = values_reverse[0].toLowerCase();\r\n        normal_reverse = values_reverse[1];\r\n        var multiplier = parseFloat(normal_reverse.replace(\"r\",\"\"));\r\n\r\n        if(normal_reverse.indexOf(\"r\") == 0){ //reverse the values\r\n          this_value = process_score(row_no,values_col,this_response,item,\"r\");\r\n        } else {\r\n          this_value = process_score(row_no,values_col,this_response,item);\r\n        }\r\n      }\r\n      if(typeof(this_value) !== \"undefined\"){\r\n        this_score += multiplier * this_value;\r\n      } else {\r\n        complete_score = false;\r\n      }\r\n    });\r\n    if(complete_score){\r\n      $(\".score_\"+scale).addClass(\"bg-success\");\r\n      $(\".score_\"+scale).removeClass(\"bg-danger\");\r\n      $(\".score_\"+scale).addClass(\"text-light\");\r\n      document.getElementsByClassName(\"score_\"+scale).title = 'All relevant questions have been answered';\r\n    } else {\r\n      $(\".score_\"+scale).removeClass(\"text-success\");\r\n      $(\".score_\"+scale).addClass(\"bg-danger\");\r\n      $(\".score_\"+scale).addClass(\"text-light\");\r\n      document.getElementsByClassName(\"score_\"+scale).title = 'At least one relevant questions has NOT been answered';\r\n    }\r\n    $(\".score_\"+scale).val(this_score);\r\n  });\r\n}\r\n\r\nfunction write(type, row){\r\n  var this_html = \"\";\r\n  [feedback_array, feedback_color] = get_feedback(row);\r\n  row = shuffle_answers(row);\r\n  row[\"item_name\"] = row[\"item_name\"].toLowerCase();\r\n\r\n  if(type == \"checkbox_horizontal\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_table = $(\"<table>\");\r\n        this_row = this_table[0].insertRow()\r\n    for(var i=0; i<options.length;i++){\r\n      var this_cell = this_row.insertCell();\r\n      var this_div = $(\"<div>\");\r\n          this_div.addClass(\"custom-control\");\r\n          this_div.addClass(\"custom-checkbox\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type = \"checkbox\";\r\n          this_input[0].id = row[\"item_name\"] + i;\r\n          this_input[0].name = 'survey_' + row[\"item_name\"];\r\n          this_input.addClass(\"custom-control-input\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(row[\"custom-control\"])\r\n            .addClass(row[\"custom-checkbox\"])\r\n            .addClass(row[\"item_name\"] +'_item')\r\n            .addClass('row_' + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerText = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_input)\r\n              .append(this_label);\r\n      this_cell.innerHTML = this_div[0].outerHTML;\r\n    }\r\n    this_html += this_table[0].outerHTML;\r\n\r\n  } else if(type == \"checkbox_single\"){\r\n\r\n    var this_div = $(\"<div>\");\r\n        this_div.attr(\"data-toggle\", \"buttons\");\r\n        this_div.addClass(\"btn-group-toggle\");\r\n    var this_label = $(\"<label>\");\r\n        this_label.addClass(\"btn\");\r\n        this_label.addClass(\"btn-outline-primary\");\r\n        this_label.html(row[\"answers\"]);\r\n    var this_checkbox = $(\"<input>\");\r\n        this_checkbox[0].id = row[\"item_name\"];\r\n        this_checkbox[0].name = \"survey_\" +\r\n          row[\"item_name\"].toLowerCase();\r\n        this_checkbox[0].type = \"checkbox\";\r\n        this_checkbox.attr(\"checked\",true);\r\n        this_checkbox\r\n          .addClass(\"response\")\r\n          .addClass(\r\n            row[\"item_name\"] +\r\n            '_item row_' +\r\n            row[\"row_no\"]\r\n          );\r\n    this_div.append(this_label);\r\n    this_label.append(this_checkbox)\r\n    this_html += this_div[0].outerHTML;\r\n\r\n  } else if(type == \"checkbox_vertical\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i = 0; i < options.length; i++){\r\n      feedback_string = generate_feedback_string(\r\n        feedback_array, i, feedback_color, row\r\n      );\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\");\r\n      var this_checkbox = $(\"<input>\");\r\n          this_checkbox[0].id= row[\"item_name\"]+ i;\r\n          this_checkbox[0].value = options[i];\r\n          this_checkbox[0].type = \"checkbox\";\r\n          this_checkbox[0].name = 'survey_'+\r\n            row[\"item_name\"].toLowerCase();\r\n          this_checkbox\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-checkbox\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row\");\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerHTML = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_checkbox)\r\n              .append(this_label);\r\n\r\n      this_html += this_div[0].outerHTML;\r\n    }\r\n\r\n  } else if(type == \"date\"){\r\n    var input = $(\"<input>\");\r\n        input.addClass(\"response\")\r\n             .addClass(\"custom-control\")\r\n             .addClass(\"datepicker\")\r\n             .addClass(\"date\")\r\n             .addClass(row[\"item_name\"] + \"_item\")\r\n             .addClass(\"row_\" + row[\"row_no\"])\r\n             .attr(\"name\", \"survey_\" + row['item_name'])\r\n             .attr(\"type\", \"text\");\r\n\r\n  } else if(type == \"dropdown\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_dropdown = $(\"<select>\");\r\n        this_dropdown.addClass(\"form-control\")\r\n          .addClass(\"response\")\r\n          .addClass(\"txt-primary\")\r\n          .addClass(row[\"item_name\"] + \"_item\")\r\n          .addClass(\"row_\" + row[\"row_no\"])\r\n          .addClass(\"collector_button\")\r\n          .attr(\"name\", \"survey_\" + row[\"item_name\"])\r\n          .css(\"margin\", \"0px\")\r\n          .css(\"width\", \"auto\");\r\n\r\n    /* this will be necessary to tidy up jumbled sentences\r\n    if(typeof(row[\"item_name_old\"]) !== \"undefined\"){\r\n      this_dropdown.addClass(row[\"item_name_old\"] + \"_item\");\r\n    }\r\n    */\r\n\r\n    this_dropdown.append(\"<option selected disabled hidden>-- no option selected --</option>\");\r\n    options.forEach(function(this_option){\r\n      this_dropdown.append(\r\n        \"<option>\" + this_option + \"</option>\"\r\n      );\r\n    });\r\n    var this_html = this_dropdown[0].outerHTML;\r\n\r\n  } else if(type == \"email\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input\r\n          .addClass(\"form-control\")\r\n          .addClass(\"response\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .attr(\"type\", \"email\")\r\n          .attr(\"name\", 'survey_' + row['item_name']);\r\n\r\n  } else if(type == \"instruct\"){\r\n    this_html += \"<td colspan='2'>\" + row[\"text\"] + \"</td>\";\r\n  } else if(type == \"jumbled\"){\r\n    var this_td = $(\"<td>\");\r\n        this_td.attr(\"colspan\",2) ;\r\n\r\n    var this_div = $(\"<div>\");\r\n        this_div.addClass(\"form-inline\")\r\n                .addClass(\"bg-secondary\")\r\n                .addClass(\"text-white\")\r\n                .css(\"width\", \"100%\")\r\n                .css(\"padding\", \"20px\")\r\n                .css(\"margin\", \"20px\")\r\n                .css(\"border-radius\", \"5px\");\r\n\r\n    var question = row[\"text\"].split(\"|\");\r\n    questions_html = question.map(function(text,index){\r\n      if(index == question.length - 1){\r\n        return text;\r\n      } else {\r\n        var row_x = row;\r\n        row_x[\"item_name_old\"] = row_x[\"item_name\"];\r\n        row_x[\"item_name\"]     = row_x[\"item_name\"] + \"_\" + index;\r\n        var row_html = text + write(\"dropdown\", row_x)\r\n          .replace(\"margin: 0px\",\"margin: 5px\");\r\n        row_x[\"item_name\"] = row_x[\"item_name_old\"];\r\n        return row_html;\r\n      }\r\n    }).join(\"\");\r\n\r\n    this_td.append(this_div);\r\n    this_div.append(questions_html);\r\n\r\n    this_html = this_td[0].outerHTML;\r\n\r\n  } else if(type == \"likert\"){\r\n    // set styles\r\n    if(typeof(row[\"btn_width\"]) == \"undefined\"){\r\n      row[\"btn_width\"] = \"auto\"\r\n    }\r\n    if(typeof(row[\"side_width\"]) == \"undefined\"){\r\n      var side_width = \"auto\";\r\n    }\r\n\r\n    // create and build these elements\r\n    var this_div = $(\"<div>\");\r\n    if(typeof(row[\"side_text\"]) !== \"undefined\" &&\r\n      row[\"side_text\"] !== \"\"\r\n    ){\r\n      side_text = row[\"side_text\"].split(\"|\");\r\n      side_text = side_text.map(function(this_side){\r\n        var this_span = $(\"<span>\");\r\n            this_span.css(\"width\", side_width)\r\n                     .css(\"padding\", \"20px\")\r\n                     .addClass(\"text-primary\")\r\n                     .html(\"<b>\" + this_side + \"</b>\");\r\n        return this_span[0].outerHTML;\r\n      });\r\n    } else {\r\n      side_text = [\"\",\"\"];\r\n    }\r\n\r\n    this_div\r\n      .addClass(\"btn-group\")\r\n      .addClass(\"btn-group-toggle\")\r\n      .append(side_text[0])\r\n      .attr(\"data-togle\",\"buttons\");\r\n\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i=0; i<options.length;i++){\r\n      var this_button = $(\"<button>\");\r\n          this_button\r\n            .attr(\"autocomplete\", \"off\")\r\n            .attr(\"id\", 'likert_' + row[\"row_no\"] + '_' + i)\r\n            .attr(\"onclick\",'likert_update(this)')\r\n            .attr(\"value\", values[i])\r\n            .addClass(\"btn\")\r\n            .addClass(\"btn-outline-primary\")\r\n            .addClass(\"survey_btn\")\r\n            .addClass(\r\n              row[\"item_name\"] + '_item row_' + row[\"row_no\"]\r\n            )\r\n            .css(\"width\", row[\"btn_width\"])\r\n            .html(clean_item(options[i]));\r\n      this_div.append(this_button);\r\n    }\r\n    this_div.append(side_text[1]);\r\n    this_html += this_div[0].outerHTML;\r\n\r\n  } else if(type == \"number\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input[0].type = \"number\";\r\n        this_input[0].name = 'survey_' + row['item_name'];\r\n        this_input\r\n          .addClass(\"response\")\r\n          .addClass(\"form-control\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"]);\r\n    this_html += this_input[0].outerHTML;\r\n\r\n  } else if(type == \"para\"){\r\n    var this_textarea = $(\"<textarea>\");\r\n        this_textarea[0].name = \"survey_\" + row['item_name'];\r\n        this_textarea\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .addClass(\"response\");\r\n        this_textarea.css(\"width\", \"100%\")\r\n                     .css(\"height\", \"200px\");\r\n    this_html += this_textarea[0].outerHTML;\r\n\r\n  } else if(type == \"radio_horizontal\"){\r\n\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var this_table = $(\"<table>\");\r\n        this_row = this_table[0].insertRow()\r\n    for(var i=0; i<options.length;i++){\r\n      var this_cell = this_row.insertCell();\r\n      var this_div = $(\"<div>\");\r\n          this_div.addClass(\"custom-control\");\r\n          this_div.addClass(\"custom-radio\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type = \"radio\";\r\n          this_input[0].id = row[\"item_name\"] + i;\r\n          this_input[0].name = 'survey_' + row[\"item_name\"];\r\n          this_input.addClass(\"custom-control-input\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(row[\"custom-control\"])\r\n            .addClass(row[\"custom-radio\"])\r\n            .addClass(row[\"item_name\"] +'_item')\r\n            .addClass('row_' + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"] + i;\r\n          this_label[0].innerText = options[i];\r\n          this_label.addClass(\"custom-control-label\");\r\n      this_div.append(this_input)\r\n              .append(this_label);\r\n      this_cell.innerHTML = this_div[0].outerHTML;\r\n    }\r\n    this_html += this_table[0].outerHTML;\r\n\r\n  } else if(type == \"radio_vertical\"){\r\n    var options = row[\"answers\"].split(\"|\");\r\n    var values  = row[\"values\"].split(\"|\");\r\n    for(var i=0; i<options.length; i++){\r\n      feedback_string = generate_feedback_string(\r\n        feedback_array, i, feedback_color,row\r\n      );\r\n      var this_div = $(\"<div>\");\r\n          this_div\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-radio\");\r\n      var this_input = $(\"<input>\");\r\n          this_input[0].type  = \"radio\";\r\n          this_input[0].id    = row[\"item_name\"] + i;\r\n          this_input[0].value = options[i];\r\n          this_input[0].name  = 'survey_' + row[\"item_name\"];\r\n          this_input\r\n            .addClass(\"custom-control-input\")\r\n            .addClass(row[\"this_class\"])\r\n            .addClass(\"custom-control\")\r\n            .addClass(\"custom-radio\")\r\n            .addClass(\"response\")\r\n            .addClass(row[\"item_name\"] + \"_item_row_\" + row[\"row_no\"]);\r\n      var this_label = $(\"<label>\");\r\n          this_label[0].htmlFor = row[\"item_name\"]+i;\r\n          this_label.addClass(\"custom-control-label\");\r\n          this_label.html(options[i]);\r\n      this_div\r\n        .append(this_input)\r\n        .append(this_label)\r\n        .append(feedback_string);\r\n      this_html += this_div[0].outerHTML;\r\n    }\r\n\r\n  } else if(type == \"text\"){\r\n    var this_input = $(\"<input>\");\r\n        this_input[0].type=\"text\";\r\n        this_input[0].name=\"survey_\" + row['item_name'];\r\n        this_input\r\n          .addClass(\"form-control\")\r\n          .addClass(row[\"item_name\"] + \"_item row_\" + row[\"row_no\"])\r\n          .addClass(\"response\")\r\n    this_html += this_input[0].outerHTML;\r\n  }\r\n\r\n  switch(type){\r\n    case \"checkbox_vertical\":\r\n    case \"radio_vertical\":\r\n      // do nothing\r\n      break;\r\n    default:\r\n      this_html += generate_feedback_string(\r\n        feedback_array,\r\n        0,\r\n        feedback_color,\r\n        row\r\n      );\r\n      break;\r\n  }\r\n\r\n  return (this_html);\r\n}\r\n\r\nfunction write_survey(this_survey, this_id){\r\n  scoring_object.update_scales(this_survey);\r\n  survey_html = \"<table class='table_break' id='table0'>\";\r\n  this_survey_object={\r\n    content:[],\r\n    shuffle_question:[],\r\n    content_new_order:[],\r\n    shuffled_content:[],\r\n    shuffled_arrays:{},\r\n  }\r\n\r\n  survey_html += \"<tr>\";\r\n  for(i = 0; i < this_survey.length; i++){\r\n    row = this_survey[i];\r\n    row_html = process_question(row,i);\r\n\t\tthis_survey_object.content.push(row_html[0]);\r\n    this_survey_object.shuffle_question.push(row_html[1]);\r\n\t}\r\n\r\n\tunique_shuffles = this_survey_object.shuffle_question.filter((v,i,a)=>a.indexOf(v)==i); //by Camilo Martin on https://stackoverflow.com/questions/1960473/unique-values-in-an-array\r\n\r\n\tfor(var i=0;i<unique_shuffles.length;i++){\r\n    if(typeof(unique_shuffles[i]) !== \"undefined\" &&\r\n      unique_shuffles[i] !== \"none\" &&\r\n      unique_shuffles[i] !== \"\"){\r\n        shuffled_content = this_survey_object.shuffle_question.map(function(element,index){\r\n    \t   if(typeof(element)!== \"undefined\" && element.toLowerCase() !== \"none\" && element.toLowerCase() == unique_shuffles[i]){\r\n  \t       return this_survey_object.content[index];\r\n    \t   }\r\n    \t}).filter(elm => typeof(elm) !== \"undefined\");\r\n    \tnew_order = shuffle(shuffled_content);\r\n    \tthis_survey_object.shuffled_arrays[unique_shuffles[i]]=new_order; // add new array with dynamic name\r\n    }\r\n\t}\r\n\r\n\tfor(var i=0;i<this_survey_object.content.length;i++){\r\n    var this_index = Object.keys(this_survey_object.shuffled_arrays).indexOf(this_survey_object.shuffle_question[i]);\r\n    if(this_index !== -1){\r\n      //take first item off relevant list and delete item\r\n      var this_item = this_survey_object.shuffled_arrays[Object.keys(this_survey_object.shuffled_arrays)[this_index]].shift();\r\n      this_survey_object.content_new_order[i]=this_item;\r\n    } else {\r\n      this_survey_object.content_new_order[i]=this_survey_object.content[i];\r\n    }\r\n\t}\r\n\r\n\tqs_in_order = this_survey_object.content_new_order.join(\"</tr><tr>\");\r\n\tqs_in_order += \"</tr>\";\r\n\r\n\tsurvey_html += qs_in_order;\r\n\tsurvey_html += \"</table>\";\r\n\r\n\t$(\"#\" + this_id).html(survey_html);\r\n\r\n  $(\".response\").on(\"change\", function(){\r\n    response_check(this);\r\n  })\r\n\r\n  $(\"#\" + this_id).show(1000); //scroll to top\r\n\r\n\t$(\".show_tab\").on(\"click\",function(){\r\n    if(this.className.indexOf(\"disabled\") == -1){\r\n      $(\".show_tab\").removeClass(\"active\");\r\n      $(\".survey_page\").hide();\r\n      $(\"#\"+this.id.replace(\"_button\",\"\")).show();\r\n    } else {\r\n      bootbox.alert(\"You have not yet unlocked this tab - maybe try clicking on <b>Proceed</b>?\");\r\n    }\r\n\t});\r\n  $('[data-toggle=\"tooltip\"]').tooltip();\r\n  $(\".custom-checkbox\").prop(\"indeterminate\",true);\r\n}\r\n\r\n/*\r\n* Load survey\r\n*/\r\ncurrent_survey = \"{{survey}}\";\r\nif(typeof(Phase) !== \"undefined\"){\r\n  Phase.set_timer(function(){\r\n    load_survey(current_survey);\r\n  },100);\r\n} else {\r\n  load_survey(current_survey);\r\n}\r\n</script>\r\n",
    "debrief_magmot": "<style>\r\n#instruct_text{\r\n  margin:auto;\r\n  width:600;\r\n\r\n}\r\n#proceed_button{\r\n  position:absolute;\r\n  right: 20px;\r\n}\r\n#trial_contents{\r\n  position: absolute;\r\n  top:0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  margin:auto;\r\n  width:600;\r\n  height:800;\r\n}\r\n</style>\r\n<div id=\"trial_contents\">\r\n  <div id=\"instruct_text\">{{text}}</div>\r\n  \r\n  <p>If you are enrolled at Reading University and have signed up using the PCLS Research Panel, please answer the following debrief questions.</p>\r\n  <p>1. What are the independent variables in this experiment?</p>  \r\n  <input type=\"text\" id=\"debriefAnswer1\" name=\"debriefAnswer1\" class=\"collectorInput\" size=\"60%\">\r\n  <p>2. Why is the cover story in an incidental memory encoding paradigm important? </p>  \r\n  <input type=\"text\" id=\"debriefAnswer2\" name=\"debriefAnswer2\" class=\"collectorInput\" size=\"60%\">\r\n  <br><br>\r\n  <button class=\"btn btn-primary\" id=\"proceed_button\" onclick=\"Trial.submit()\">Proceed</button>  \r\n</div>\r\n\r\n"
  },
  "procs_csv": {},
  "stims_csv": {}
}